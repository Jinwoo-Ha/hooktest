#!/bin/sh

echo "🔍 Push 전 파일 검사를 시작합니다..."

# 삭제된 파일 확인
deleted_files=$(git diff origin/main...HEAD --diff-filter=D --name-only)

# 삭제된 파일이 있는 경우
if [ ! -z "$deleted_files" ]; then
    echo ""
    echo "⚠️ 경고: 다음 파일들이 삭제될 예정입니다:"
    echo "$deleted_files"
    echo ""
    echo "삭제를 진행하려면 'yes'를 입력하세요."
    echo "입력을 기다리는 중..."
    
    # 사용자 입력을 받을 때까지 대기
    while true; do
        read -r answer
        if [ "$answer" = "yes" ]; then
            echo ""
            echo "✅ 삭제를 진행합니다."
            break
        elif [ ! -z "$answer" ]; then
            echo ""
            echo "❌ Push가 취소되었습니다."
            exit 1
        fi
    done
fi

echo "✅ Push를 진행합니다."
exit 0